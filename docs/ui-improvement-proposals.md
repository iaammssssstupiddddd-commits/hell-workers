# UIパネル ビジュアル・操作感 改善案

## 現状の概要

現在のUIは以下のパネルで構成されている:
- **左パネル**: エンティティリスト（使い魔・ソウル一覧）
- **右パネル**: 情報パネル（選択エンティティの詳細）
- **下部バー**: モード切替（Architect / Zones / Orders）
- **右上**: 時間コントロール（時計・速度変更）
- **ツールチップ**: ワールドエンティティのホバー情報

---

## 1. ホバーフィードバックの強化

### 現状の問題
- ソウルリストアイテムにホバー状態がない（背景が変わらない）
- 使い魔ヘッダーのホバー反応が薄い
- UIボタンにツールチップがない（ワールドエンティティのみ対応）

### 改善案

#### 1-1. リストアイテムのホバーハイライト
- ソウル行にホバー時の背景色を追加（例: `srgba(0.4, 0.4, 0.6, 0.3)`）
- 角丸（`border_radius: 2px`）を適用し、ホバー領域を明示
- 使い魔ヘッダーも同様にホバー時の視覚変化を強化

#### 1-2. ボタンツールチップ
- 下部バーのボタン（Architect、Zones、Orders）にツールチップを追加
- 時間コントロールボタンにも速度表示ツールチップを追加
- 例: 「||」→「一時停止」、「>>>」→「超高速 (x10)」

#### 1-3. カーソル形状の変化
- クリック可能な要素にホバーした際、カーソルが変わる仕組みの検討
- Bevyのウィンドウカーソル制御（`CursorIcon`）を活用

---

## 2. 選択状態の視認性向上

### 現状の問題
- エンティティリストで選択中のアイテムが視覚的に判別しにくい
- 右パネルが表示されるが、どのアイテムが選択されているか一覧上で追いにくい

### 改善案

#### 2-1. 選択ハイライト
- 選択中のソウル行に明確な背景色を付与（例: `srgba(0.3, 0.5, 0.8, 0.4)`）
- 左ボーダーにアクセントカラーのライン（2〜3px）を表示
- 選択中の使い魔ヘッダーも同様にハイライト

#### 2-2. フォーカス連動
- エンティティリストで選択した項目が画面外の場合、自動スクロールで表示
- ワールド上で直接エンティティをクリックした際も、リスト側の該当行をハイライト

---

## 3. パネルレイアウトの改善

### 現状の問題
- すべてのパネルが絶対位置（ピクセル指定）で配置されている
- パネルサイズが固定で、内容量に応じた調整がない
- 情報パネル（右）が200px固定で、内容が長い場合に窮屈

### 改善案

#### 3-1. パネルサイズの柔軟化
- エンティティリストの幅をドラッグでリサイズ可能にする
- 情報パネルの高さを内容に応じて自動調整（最大高さ制限付き）

#### 3-2. スクロール対応
- エンティティリストにスクロールバーを追加（`overflow: scroll`）
- 情報パネルにもスクロール対応を追加（所持品リストが長い場合）
- スクロールバーのスタイル: 細め（4px）、半透明、ホバー時に表示

#### 3-3. パネル位置の定数化
- 現在散在しているパネル位置（`top: 120px`, `left: 20px` 等）を `theme.rs` に集約
- 将来的なレスポンシブ対応の基盤整備

---

## 4. カラーテーマの統一

### 現状の問題
- パネル背景のグラデーション色がファイルごとにハードコードされている
  - 左パネル: 青系 `(0.1, 0.3, 0.5, 0.9)` → 黒
  - 右パネル: 紫系 `(0.3, 0.1, 0.3, 0.9)` → 黒
  - 下部バー: 赤系 `(0.4, 0.1, 0.1, 0.9)` → 黒
- ボタン色がファイルごとにバラバラ（`0.2, 0.2, 0.2` が多いが統一されていない）

### 改善案

#### 4-1. テーマ定数の拡充
`theme.rs` に以下を追加:
```
// パネル背景グラデーション
COLOR_PANEL_LEFT_TOP / COLOR_PANEL_LEFT_BOTTOM
COLOR_PANEL_RIGHT_TOP / COLOR_PANEL_RIGHT_BOTTOM
COLOR_PANEL_BOTTOM_TOP / COLOR_PANEL_BOTTOM_BOTTOM

// 汎用ボタン色
COLOR_BUTTON_DEFAULT / COLOR_BUTTON_HOVER / COLOR_BUTTON_PRESSED / COLOR_BUTTON_ACTIVE

// テキスト色
COLOR_TEXT_PRIMARY / COLOR_TEXT_SECONDARY / COLOR_TEXT_ACCENT
```

#### 4-2. ダークテーマの統一感
- 全パネルの基調色を統一（例: 暗い青紫系に寄せる）
- パネル間の色味の差は維持するが、彩度と明度の範囲を揃える
- ボーダーや区切り線に共通の微光色（例: `srgba(0.5, 0.5, 0.7, 0.3)`）を使用

---

## 5. アニメーション・トランジション

### 現状の問題
- すべてのUI状態変化が即座に切り替わる（`Display::None` ↔ `Display::Flex`）
- 折りたたみ/展開、パネル表示/非表示が瞬間的で唐突

### 改善案

#### 5-1. フェードイン/フェードアウト
- 情報パネルの表示/非表示にフェードアニメーション（0.15秒程度）
- ツールチップの出現にも短いフェード（0.1秒）

#### 5-2. セクション折りたたみアニメーション
- 使い魔セクションの展開/折りたたみに高さのトランジション
- Bevyのアニメーションシステム、または毎フレームの補間で実現

#### 5-3. 実装の優先度
- パフォーマンスへの影響を最小限にするため、簡素なアルファ補間から着手
- 複雑なレイアウトアニメーションは後回し

---

## 6. 情報パネルの充実

### 現状の問題
- ソウルの情報パネルにステータスバーがない（数値のみ）
- タスク進捗が文字列のみで直感的でない

### 改善案

#### 6-1. ステータスバーの追加
- Motivation / Stress / Fatigue にプログレスバーを追加
  - バー背景: 暗いグレー
  - バー塗り: ステータスに応じた色（Stress: 黄→赤、Fatigue: 青紫）
  - バー高さ: 4〜6px、幅: パネル幅に合わせる

#### 6-2. タスク進捗の可視化
- 現在のタスクにプログレスバーを表示（該当する場合）
- 例: 建築進捗 45% → バーで表示

#### 6-3. アイコンの拡充
- 情報パネルのステータス項目にもアイコンを表示（エンティティリストと統一）
- Blueprint選択時にビルディングタイプのアイコンを表示

---

## 7. 操作性の改善

### 現状の問題
- すべての操作がマウスクリックに依存
- コンテキストメニューは使い魔の右クリックのみ

### 改善案

#### 7-1. キーボードショートカット
- `1`〜`4`: 時間速度切替
- `Space`: 一時停止/再開トグル
- `B`: Architectモード
- `Z`: Zonesモード
- `Tab`: エンティティリストのフォーカス切替

#### 7-2. ドラッグ＆ドロップ
- ソウルを使い魔セクション間でドラッグして配属変更
- 直感的な分隊管理の実現

#### 7-3. 右クリックメニューの拡充
- ソウル右クリック: タスク手動割り当て、使い魔への配属
- リソース右クリック: 優先度設定、運搬指示

---

## 8. フォント・テキストの整理

### 現状の問題
- フォントサイズが `theme.rs` の定数と直接値（`18.0`, `14.0`）が混在
- フォントリソースが `font_ui`, `font_soul_name`, `font_familiar` と分かれている

### 改善案

#### 8-1. フォントサイズの統一
- すべてのフォントサイズを `theme.rs` の定数に集約
- 追加定義: `FONT_SIZE_TITLE: 18.0`, `FONT_SIZE_CLOCK: 16.0` 等

#### 8-2. フォントリソースの整理
- 用途別フォント定義を `theme.rs` またはリソースファイルに文書化
- 不要な分岐があれば統合

---

## 優先度マトリクス

| 改善項目 | 効果 | 工数 | 優先度 |
|---------|------|------|--------|
| 1-1. リストホバーハイライト | 高 | 小 | **A** |
| 2-1. 選択ハイライト | 高 | 小 | **A** |
| 4-1. テーマ定数の拡充 | 中 | 小 | **A** |
| 3-2. スクロール対応 | 高 | 中 | **B** |
| 6-1. ステータスバー | 中 | 中 | **B** |
| 7-1. キーボードショートカット | 中 | 中 | **B** |
| 1-2. ボタンツールチップ | 中 | 小 | **B** |
| 4-2. ダークテーマ統一 | 中 | 中 | **B** |
| 8-1. フォントサイズ統一 | 低 | 小 | **B** |
| 5-1. フェードアニメーション | 中 | 中 | **C** |
| 3-1. パネルリサイズ | 低 | 大 | **C** |
| 7-2. ドラッグ＆ドロップ | 高 | 大 | **C** |
| 5-2. 折りたたみアニメーション | 低 | 大 | **C** |
| 7-3. 右クリックメニュー拡充 | 中 | 中 | **C** |

**優先度の基準:**
- **A**: すぐに着手すべき（効果が高く工数が小さい）
- **B**: 次のイテレーションで対応
- **C**: 余裕があるときに検討

---

## 関連ファイル

- `src/interface/ui/theme.rs` - テーマ定数
- `src/interface/ui/setup/` - 各パネルの構築
- `src/interface/ui/list/` - エンティティリスト（ビューモデル・同期・インタラクション）
- `src/interface/ui/components.rs` - UIコンポーネント定義
- `docs/entity_list_ui.md` - エンティティリスト仕様
- `docs/info_panel_ui.md` - 情報パネル仕様
