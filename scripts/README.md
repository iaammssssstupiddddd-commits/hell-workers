# ビルドキャッシュと容量最適化ガイド

## 重要な質問：容量を削減するとビルド速度は遅くなりますか？

**答え：適切に最適化すれば、ビルド速度への影響は最小限です！**

## target/ディレクトリの構造と重要性

### 🔴 削除してもビルド速度にほとんど影響しない（安全に削除可能）

1. **`x86_64-pc-windows-msvc/` (約7.37 GB)**
   - クロスコンパイル用のビルド成果物
   - 現在の開発環境（Windows）では通常不要
   - 削除しても次回ビルド時に必要なら再生成される
   - **推奨：削除可能**

### 🟡 削除すると次回ビルドが遅くなるが、再生成可能

2. **`debug/build/` (約293 MB)**
   - ビルドスクリプトの成果物
   - 削除すると次回ビルド時に再生成が必要（数分かかる場合あり）
   - **推奨：容量に余裕がある場合は保持**

### 🟢 ビルド速度に重要（保持すべき）

3. **`debug/deps/` (約841 MB)**
   - **依存関係のコンパイル済みコード**
   - これを削除すると、すべての依存関係を再コンパイルする必要がある
   - Bevyのような大きな依存関係がある場合、数十分かかることがある
   - **推奨：絶対に保持**

4. **`debug/incremental/` (現在はほぼ空)**
   - **インクリメンタルコンパイルキャッシュ**
   - コードを少し変更した時の再コンパイルを高速化
   - 最新のキャッシュは保持すべき
   - 古いキャッシュ（7日以上）は削除可能
   - **推奨：最新のものは保持**

## 推奨される最適化手順

### 方法1: 安全な最適化（推奨）

```powershell
.\scripts\optimize-target.ps1
```

これにより：
- ✅ `x86_64-pc-windows-msvc/`を削除（約7.37 GB削減）
- ✅ 古いインクリメンタルキャッシュを削除（数MB～数百MB削減）
- ✅ `debug/deps/`と最新の`incremental/`は保持（ビルド速度維持）

**結果：約7.37 GB削減、ビルド速度への影響はほとんどなし**

### 方法2: より積極的な最適化

```powershell
.\scripts\optimize-target.ps1
# build/も削除する場合は「y」を入力
```

**結果：約7.66 GB削減、次回ビルド時に少し時間がかかる**

## 容量とビルド速度のバランス

| 削除する項目 | 削減容量 | ビルド速度への影響 |
|------------|---------|------------------|
| `x86_64-pc-windows-msvc/` | 約7.37 GB | なし（通常開発では不要） |
| 古い`incremental/`キャッシュ | 数MB～数百MB | なし（最新は保持） |
| `debug/build/` | 約293 MB | 中（次回ビルドで再生成必要） |
| `debug/deps/` | 約841 MB | **大（すべての依存関係を再コンパイル）** |

## 定期的なメンテナンス

以下のコマンドで定期的に古いキャッシュをクリーンアップ：

```powershell
# サイズ確認
.\scripts\check-size.ps1

# 最適化（対話式）
.\scripts\optimize-target.ps1

# 詳細分析
.\scripts\analyze-target.ps1
```

## 結論

**`x86_64-pc-windows-msvc/`（約7.37 GB）を削除すれば、ビルド速度を維持したまま大幅に容量を削減できます。**

これは通常の開発では使用されないため、削除しても問題ありません。必要になれば次回ビルド時に再生成されます。




