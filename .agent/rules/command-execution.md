# コマンド実行に関する指針

エージェント（AI）が本プロジェクトでコマンドを実行する際、効率的かつ確実に結果を得るためのルールです。

## 1. 同期実行の優先（WaitMsBeforeAsync の活用）

短時間（通常1分以内）で終了する以下のコマンドについては、`run_command` の `WaitMsBeforeAsync` を十分に大きく（例: `5000`〜`30000`）設定し、同期的に結果を受け取るようにしてください。

- `ls`, `grep`, `cat`, `find` などのファイル操作・検索
- `cargo check`, `cargo fmt` などの高速なコンパイルチェック
- スクリプト実行 (`python scripts/...`, `powershell scripts/...`)

**理由**: `WaitMsBeforeAsync: 0` でバックグラウンド実行にすると、コマンドが即座に終わっているにもかかわらず、エージェントがポーリングを続けて「実行中（RUNNING）」と誤判定し、作業が不必要に停滞する可能性があるため。

## 2. バックグラウンド実行（WaitMsBeforeAsync: 0）の限定利用

以下のケースに限り、バックグラウンド実行を検討してください。

- `trunk serve` やサーバー起動など、エージェントが結果を待たずに次の作業に進む必要がある長時間プロセス
- 明らかに数分以上の時間を要する重いビルド処理

## 3. ステータス監視の注意点

- コマンドが `RUNNING` のまま進展がない場合、不必要に `command_status` を繰り返さないでください。
- 同期実行で失敗した場合や、期待される出力が得られない場合は、即座に原因を調査するかユーザーに報告してください。
- 作業完了報告（notify_user）の前に、自身が開始した不要なバックグラウンドプロセスが残っていないか確認し、必要に応じて終了させてください。
